<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enter Instructions</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f9fafb;
      color: #111827;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 20px;
    }
    h2 {
      margin-top: 0;
      color: #4f46e5;
      font-size: 1.5rem;
    }
    .description {
      margin-bottom: 20px;
      color: #4b5563;
      font-size: 0.9rem;
    }
    textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
      margin-bottom: 20px;
      resize: vertical;
    }
    textarea:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    }
    .button-group {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:focus {
      outline: none;
    }
    .cancel-btn {
      background-color: #f3f4f6;
      color: #4b5563;
    }
    .cancel-btn:hover {
      background-color: #e5e7eb;
    }
    .submit-btn {
      background-color: #4f46e5;
      color: white;
    }
    .submit-btn:hover {
      background-color: #4338ca;
    }
    .clipboard-preview {
      background-color: #f3f4f6;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 20px;
      max-height: 100px;
      overflow-y: auto;
      font-size: 0.85rem;
      color: #4b5563;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .clipboard-preview-title {
      font-weight: 600;
      margin-bottom: 5px;
      font-size: 0.8rem;
      color: #6b7280;
    }
    #copySuccess {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #10b981;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }
    #copySuccess.visible {
      opacity: 1;
    }
    #copySuccess.error {
      background-color: #ef4444;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Enter Instructions</h2>
    <p class="description">Provide specific instructions for how to respond to the text in your clipboard.</p>

    <div class="clipboard-preview-title">Text from clipboard:</div>
    <div id="clipboardPreview" class="clipboard-preview">Loading...</div>

    <textarea id="instructionsInput" placeholder="Enter your instructions here (e.g., 'I am interested', 'Politely decline', 'Ask for more details')"></textarea>

    <div class="button-group">
      <button id="cancelBtn" class="cancel-btn">Cancel</button>
      <button id="submitBtn" class="submit-btn">Generate Response</button>
    </div>
  </div>

  <div id="copySuccess">Text copied to clipboard!</div>

  <script>
    // This will be filled in by the preload script
    let originalText = '';
    let currentTab = 'answer';

    // When the window loads, get the clipboard text
    window.addEventListener('DOMContentLoaded', () => {
      // Listen for the original text from the main process
      window.api.onOriginalText((text) => {
        console.log('Received original text event with text length:', text ? text.length : 0);
        originalText = text || '';

        // Update the preview with the text
        const previewElement = document.getElementById('clipboardPreview');
        if (previewElement) {
          previewElement.textContent = text && text.length > 300
            ? text.substring(0, 300) + '...'
            : (text || 'No text available');
          console.log('Updated clipboard preview with text');
        } else {
          console.error('Could not find clipboardPreview element');
        }
      });

      // Refresh the clipboard text
      console.log('Requesting clipboard text refresh');
      window.api.refreshClipboardText();

      // Also try to get the text directly after a short delay
      setTimeout(() => {
        console.log('Requesting clipboard text refresh again after delay');
        window.api.refreshClipboardText();
      }, 500);

      // Set up button event listeners
      document.getElementById('cancelBtn').addEventListener('click', () => {
        window.close();
      });

      document.getElementById('submitBtn').addEventListener('click', () => {
        const instructions = document.getElementById('instructionsInput').value.trim();
        if (!instructions) {
          alert('Please enter instructions before generating a response.');
          return;
        }

        // Disable the button to prevent multiple clicks
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Generating...';

        // Request enhancement with the instructions
        console.log('Requesting enhancement with instructions:', instructions);
        window.api.requestEnhancement('answer-with-instructions', null, false, instructions);
      });

      // Listen for enhancement results
      window.api.onEnhancementResult((text) => {
        // Show the result in a new window or handle as needed
        window.api.confirmEnhancement(text);
      });

      // Listen for enhancement errors
      window.api.onEnhancementError((error) => {
        alert('Error: ' + error);
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Generate Response';
      });
    });
  </script>
</body>
</html>
